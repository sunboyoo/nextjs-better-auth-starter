# Server-Side / Client-Side Separation Policy

本项目严格遵循服务端与客户端分离原则，确保 API 层可被多个前端应用复用。

## 设计目标

API 层作为独立服务，支持多个前端应用：

```
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   /admin     │  │   /app-1     │  │   /app-2     │
│   前端 UI    │  │   前端 UI    │  │   前端 UI    │
└──────┬───────┘  └──────┬───────┘  └──────┬───────┘
       │                 │                 │
       └────────────┬────┴─────────────────┘
                    │
                    ▼
    ┌─────────────────────────────────────────────────────────┐
    │                    /api/* (Server)                      │
    │  ┌─────────────┐  ┌─────────────┐                     │
    │  │ /api/admin  │  │ /api/...    │                     │
    │  └─────────────┘  └─────────────┘                     │
    │                         │                               │
    │                    ┌────┴────┐                          │
    │                    │   db    │                          │
    │                    └─────────┘                          │
    └─────────────────────────────────────────────────────────┘
```

## 核心原则

### 1. API 层独立性

| 原则 | 说明 |
|------|------|
| **无 UI 依赖** | `/api` 文件不导入任何 UI 组件或前端库 |
| **纯数据返回** | API 只返回 JSON 数据，不包含渲染逻辑 |
| **通用接口** | 设计接口时考虑多种前端场景 |

### 2. 数据访问规则

| 位置 | 允许 | 禁止 |
|------|------|------|
| `/api/**/route.ts` | 导入 `db`、业务逻辑 | UI 组件、React hooks |
| `/components/**` | 调用 API (`fetch`) | 直接导入 `db` |
| `/app/**/page.tsx` | 调用 API (`fetch`) | 直接导入 `db` |

## 目录结构

```
src/
├── app/
│   ├── api/                    # 服务端 API (可被任何前端复用)
│   │   ├── admin/              # 管理功能 API
│   │   └── rbac/               # 权限控制 API
│   ├── admin/                  # Admin 前端 UI
│   ├── app-1/                  # (未来) 应用1前端
│   └── app-2/                  # (未来) 应用2前端
├── components/
│   ├── admin/                  # Admin 专用组件
│   └── ui/                     # 共享 UI 组件
└── lib/                        # 服务端工具库
```

## 验证命令

```bash
# 确保 API 层无 UI 依赖
grep -r "from \"@/components" src/app/api/

# 确保前端无直接数据库访问
grep -r "from \"@/db\"" src/components/
grep -r "from \"@/db\"" src/app/ --include="*.tsx" | grep -v "/api/"
```

所有结果应为空。
